Reverted commit 18fe4d2: some fixes